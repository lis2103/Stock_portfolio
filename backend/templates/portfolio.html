<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stock Portfolio</title>
  </head>
  <body>
    <div id="root">Loading portfolio...</div>
    <!-- React and ReactDOM from CDN for simplicity -->
    <script
      crossorigin
      src="https://unpkg.com/react@17/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"
    ></script>
    <!-- Babel for JSX transformation (in-browser transformation, not recommended for production) -->
    <script src="https://unpkg.com/@babel/standalone@7.12.9/babel.min.js"></script>
    <script type="text/babel">
      class Portfolio extends React.Component {
        state = { totalPortfolioValue: 0, stocks: [] };
        componentDidMount() {
          fetch("/portfolio_symbols")
            .then((response) => response.json())
            .then((data) => {
              this.setState({
                totalPortfolioValue: data.total_portfolio_value,
                stocks: data.stocks,
              });
            })
            .catch((error) =>
              console.error("Error fetching portfolio data:", error)
            );
        }
        render() {
          const { totalPortfolioValue, stocks } = this.state;
          return (
            <div>
              <h1>Welcome to LISTOCK!</h1>
              <h2>Total Portfolio Value: ${totalPortfolioValue.toFixed(2)}</h2>
              {stocks.map((stock) => (
                <div key={stock.ticker}>
                  <h3>
                    {stock.ticker} - Quantity: {stock.quantity}
                  </h3>
                  <ul>
                    {Object.entries(stock.data).map(([date, data]) => {
                      const dataDate = new Date(date);
                      const twoWeeksAgo = new Date();
                      twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                      return dataDate >= twoWeeksAgo ? (
                        <li key={date}>
                          Date: {date}, Open: {data["1. open"]}, High:{" "}
                          {data["2. high"]}, Low: {data["3. low"]}, Close:{" "}
                          {data["4. close"]}, Volume: {data["5. volume"]}
                        </li>
                      ) : null;
                    })}
                  </ul>
                </div>
              ))}
            </div>
          );
        }
      }
      ReactDOM.render(<Portfolio />, document.getElementById("root"));
    </script>
  </body>
</html